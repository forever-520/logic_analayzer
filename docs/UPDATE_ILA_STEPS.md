# ğŸ”§ Vivado æ“ä½œæ­¥éª¤ï¼šæ›´æ–° ILA æ·»åŠ  UART æ¢é’ˆ

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

åœ¨ [src/fpga_top.v](../src/fpga_top.v) ä¸­æ·»åŠ äº† 8 ä¸ªæ–°çš„ UART è°ƒè¯•æ¢é’ˆï¼š

| Probe | ä¿¡å· | ä½å®½ | è¯´æ˜ |
|-------|------|------|------|
| probe18 | `u_uart_streamer.tx_data` | [7:0] | **å‘é€çš„å­—èŠ‚æ•°æ®** â­ |
| probe19 | `u_uart_streamer.tx_valid` | 1 | å‘é€è¯·æ±‚ä¿¡å· |
| probe20 | `u_uart_streamer.u_tx.tx_ready` | 1 | UART ç©ºé—²æ ‡å¿— |
| probe21 | `u_uart_streamer.busy` | 1 | **UART å‘é€å¿™** â­ |
| probe22 | `u_uart_streamer.rd_addr` | [10:0] | **BRAM è¯»åœ°å€** â­ |
| probe23 | `u_uart_streamer.state` | [2:0] | çŠ¶æ€æœºçŠ¶æ€ |
| probe24 | `uart_tx` | 1 | ä¸²å£ TX æ³¢å½¢ |
| probe25 | `u_uart_streamer.rd_data` | [7:0] | BRAM è¯»å‡ºæ•°æ® |

---

## ğŸš€ æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1ï¼šåœ¨ Vivado ä¸­æ‰“å¼€é¡¹ç›®

```
E:\fpga_class\vivado\logic_analyzer\logic_analyzer\logic_analyzer.xpr
```

---

### æ­¥éª¤ 2ï¼šæ›´æ–° ILA IP æ ¸

#### æ–¹æ³• Aï¼šä½¿ç”¨ TCL è„šæœ¬ï¼ˆæ¨èï¼Œæœ€å¿«ï¼‰

1. åœ¨ Vivado ä¸­æ‰“å¼€ **Tcl Console**ï¼ˆåº•éƒ¨çª—å£ï¼‰

2. è¿è¡Œè„šæœ¬ï¼š
   ```tcl
   source E:/fpga_class/vivado/logic_analyzer/scripts/update_ila_probes.tcl
   ```

3. æŸ¥çœ‹è¾“å‡ºï¼Œåº”è¯¥æ˜¾ç¤ºï¼š
   ```
   Found ILA IP: ila
   ILA IP updated successfully with 26 probes!
   New UART debug probes:
     probe18: tx_data [7:0]
     probe19: tx_valid
     ...
   ```

4. è·³åˆ°**æ­¥éª¤ 3**

---

#### æ–¹æ³• Bï¼šæ‰‹åŠ¨æ›´æ–° ILA IP

å¦‚æœ TCL è„šæœ¬å¤±è´¥ï¼Œæ‰‹åŠ¨æ›´æ–°ï¼š

1. **æ‰¾åˆ° ILA IP**ï¼š
   - åœ¨å·¦ä¾§ **Sources** çª—å£
   - å±•å¼€ **IP Sources**
   - æ‰¾åˆ° `ila` IP

2. **é‡æ–°é…ç½® ILA**ï¼š
   - å³é”® `ila` â†’ **Customize IP...**
   - æˆ–åŒå‡» `ila` IP

3. **ä¿®æ”¹æ¢é’ˆæ•°é‡**ï¼š
   - **General Options â†’ Number of Probes**: æ”¹ä¸º `26`
   - ç‚¹å‡» **OK**

4. **é…ç½®æ–°æ¢é’ˆä½å®½**ï¼š

   è‡ªåŠ¨ç”Ÿæˆçš„æ–°æ¢é’ˆï¼ˆprobe18-25ï¼‰éœ€è¦è®¾ç½®æ­£ç¡®çš„ä½å®½ï¼š

   | Probe | Probe Width | Probe Type |
   |-------|-------------|------------|
   | probe18 | 8 | Data |
   | probe19 | 1 | Data |
   | probe20 | 1 | Data |
   | probe21 | 1 | Data |
   | probe22 | 11 | Data |
   | probe23 | 3 | Data |
   | probe24 | 1 | Data |
   | probe25 | 8 | Data |

5. **ç”Ÿæˆ IP**ï¼š
   - ç‚¹å‡» **Generate**
   - ç­‰å¾…å®Œæˆ

---

### æ­¥éª¤ 3ï¼šè¿è¡Œç»¼åˆ

1. ç‚¹å‡» **Run Synthesis**
2. ç­‰å¾…å®Œæˆï¼ˆçº¦ 2-5 åˆ†é’Ÿï¼‰
3. å¦‚æœæœ‰è­¦å‘Šï¼Œå¯ä»¥å¿½ç•¥ï¼ˆåªè¦æ²¡æœ‰é”™è¯¯ï¼‰

**æ£€æŸ¥ ILA æ˜¯å¦æ­£ç¡®**ï¼š
- ç»¼åˆå®Œæˆåï¼Œæ‰“å¼€ **Synthesized Design**
- åœ¨ **Netlist** çª—å£æœç´¢ `u_ila_la`
- ç¡®è®¤æœ‰ 26 ä¸ª probe è¿æ¥

---

### æ­¥éª¤ 4ï¼šè¿è¡Œå®ç°å’Œç”Ÿæˆ Bitstream

1. **Run Implementation**
   - ç­‰å¾…å®Œæˆï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰

2. **Generate Bitstream**
   - ç­‰å¾…å®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

---

### æ­¥éª¤ 5ï¼šä¸‹è½½åˆ° FPGA

1. **è¿æ¥å¼€å‘æ¿**ï¼ˆUSB JTAG + ä¸Šç”µï¼‰

2. **Open Hardware Manager**
   - **Flow â†’ Open Hardware Manager**
   - **Open Target â†’ Auto Connect**

3. **Program Device**
   - å³é”® FPGA â†’ **Program Device...**
   - ç¡®è®¤é€‰æ‹©äº† `.bit` å’Œ `.ltx` æ–‡ä»¶
   - âœ… å‹¾é€‰ "Refresh device after programming"
   - ç‚¹å‡» **Program**

---

### æ­¥éª¤ 6ï¼šæŸ¥çœ‹æ–°çš„ UART æ¢é’ˆ

ä¸‹è½½å®Œæˆåï¼ŒHardware Manager ä¼šåˆ·æ–° ILA çª—å£ã€‚

**åœ¨å·¦ä¾§ä¿¡å·åˆ—è¡¨ä¸­ï¼Œä½ ç°åœ¨åº”è¯¥èƒ½çœ‹åˆ°**ï¼š

```
åŸæœ‰ä¿¡å·ï¼ˆprobe0-17ï¼‰:
  sample_data[7:0]
  wr_en
  wr_addr[10:0]
  capturing
  triggered
  capture_done
  ...

æ–°å¢ UART ä¿¡å·ï¼ˆprobe18-25ï¼‰:
  â­ probe18 [7:0]   â† tx_dataï¼ˆå‘é€å­—èŠ‚ï¼‰
     probe19 [0:0]   â† tx_valid
     probe20 [0:0]   â† tx_ready
  â­ probe21 [0:0]   â† busyï¼ˆå‘é€å¿™æ ‡å¿—ï¼‰
  â­ probe22 [10:0]  â† rd_addrï¼ˆBRAM åœ°å€ï¼‰
     probe23 [2:0]   â† stateï¼ˆçŠ¶æ€æœºï¼‰
     probe24 [0:0]   â† uart_txï¼ˆä¸²å£æ³¢å½¢ï¼‰
     probe25 [7:0]   â† rd_dataï¼ˆBRAM æ•°æ®ï¼‰
```

---

### æ­¥éª¤ 7ï¼šé…ç½®è§¦å‘æ¡ä»¶

**æ¨èè§¦å‘æ–¹æ¡ˆï¼šæ•è· UART å‘é€å¼€å§‹**

1. åœ¨ **Trigger Setup** çª—å£ä¸­ï¼š
   ```
   probe21 (busy):  [  ] ==  [â—] R (Rising Edge)
   ```

2. **å«ä¹‰**ï¼šå½“ UART å¼€å§‹å‘é€ï¼ˆbusy ä» 0â†’1ï¼‰æ—¶è§¦å‘

3. **Capture Setup**ï¼š
   - Trigger Position: `512`
   - Window Depth: `8192`

---

### æ­¥éª¤ 8ï¼šè¿è¡Œæ•è·

1. ç‚¹å‡» **â–¶ Run Trigger** æŒ‰é’®
2. ILA è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆ"Waiting for Trigger..."ï¼‰
3. **åœ¨ FPGA æ¿ä¸ŠæŒ‰ RUN æŒ‰é’®**ï¼ˆbtn_trigger_enï¼‰
4. ç­‰å¾…é‡‡æ ·å®Œæˆ
5. **ILA åº”è¯¥ç«‹å³è§¦å‘** âœ…

---

### æ­¥éª¤ 9ï¼šåˆ†ææ³¢å½¢

#### ğŸ” æŸ¥çœ‹ probe18 (tx_data) çš„æ•°æ®

1. åœ¨æ³¢å½¢çª—å£ä¸­æ‰¾åˆ° **probe18**
2. å³é”® â†’ **Radix â†’ Hexadecimal**
3. å±•å¼€æŸ¥çœ‹æ•°æ®å€¼

**é¢„æœŸçœ‹åˆ°çš„æ•°æ®åºåˆ—**ï¼š

| Time | probe21(busy) | probe19(tx_valid) | probe18(tx_data) | è¯´æ˜ |
|------|---------------|-------------------|------------------|------|
| T0 | 0 | 0 | xx | ç©ºé—² |
| T1 | 1 | 1 | **55** | å¸§å¤´å­—èŠ‚ 1 âœ… |
| T2 | 1 | 1 | **AA** | å¸§å¤´å­—èŠ‚ 2 âœ… |
| T3 | 1 | 1 | **00** | é•¿åº¦ä½å­—èŠ‚ |
| T4 | 1 | 1 | **08** | é•¿åº¦é«˜å­—èŠ‚ (0x0800=2048) âœ… |
| T5 | 1 | 1 | 01 | è§¦å‘ç´¢å¼•ä½å­—èŠ‚ |
| T6 | 1 | 1 | 00 | è§¦å‘ç´¢å¼•é«˜å­—èŠ‚ |
| T7 | 1 | 1 | 21 | æ•°æ®å­—èŠ‚ 0 |
| ... | 1 | 1 | ... | åç»­ 2041 å­—èŠ‚ |

---

#### ğŸ” æŸ¥çœ‹ probe22 (rd_addr) åœ°å€é€’å¢

1. æ‰¾åˆ° **probe22**
2. å³é”® â†’ **Radix â†’ Unsigned Decimal**
3. åº”è¯¥çœ‹åˆ°ï¼š`0 â†’ 1 â†’ 2 â†’ ... â†’ 2047`

---

#### ğŸ” æŸ¥çœ‹ probe24 (uart_tx) ä¸²å£æ³¢å½¢

1. æ”¾å¤§æ—¶é—´è½´ï¼ˆZoom Inï¼‰
2. æŸ¥çœ‹å•ä¸ªå­—èŠ‚çš„å‘é€æ³¢å½¢
3. åº”è¯¥ç¬¦åˆ 8N1 æ ¼å¼ï¼ˆ1 start + 8 data + 1 stop bitï¼‰

---

## âœ… éªŒè¯æ¸…å•

å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹æ‰€æœ‰é¡¹ï¼š

- [ ] ILA ä¸­çœ‹åˆ° probe18-probe25ï¼ˆ8 ä¸ªæ–°ä¿¡å·ï¼‰
- [ ] probe18 (tx_data) æ˜¾ç¤º `55 AA 00 08 ...` âœ…
- [ ] probe21 (busy) æœ‰é•¿æ—¶é—´é«˜ç”µå¹³ï¼ˆçº¦ 178msï¼‰âœ…
- [ ] probe22 (rd_addr) ä» 0 é€’å¢åˆ° 2047 âœ…
- [ ] probe19 (tx_valid) åœ¨å‘é€æ—¶ä¸º 1 âœ…

**å¦‚æœä»¥ä¸Šå…¨éƒ¨é€šè¿‡ï¼ŒUART æ¨¡å—å·¥ä½œæ­£å¸¸ï¼** ğŸ‰

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: TCL è„šæœ¬è¿è¡Œå¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`ERROR: ILA IP not found`

**è§£å†³æ–¹æ³•**ï¼š
- ILA IP å¯èƒ½ä¸åœ¨ IP Sources ä¸­
- ä½¿ç”¨**æ–¹æ³• B**æ‰‹åŠ¨æ›´æ–°

---

### Q2: ç»¼åˆæ—¶æŠ¥é”™ "probe18 not found"

**å¯èƒ½åŸå› **ï¼šILA IP æ²¡æœ‰æ›´æ–°åˆ° 26 ä¸ªæ¢é’ˆ

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰“å¼€ IP Catalog
2. æ‰¾åˆ° `ila` IP
3. ç¡®è®¤ **Number of Probes = 26**
4. é‡æ–°ç”Ÿæˆ IP

---

### Q3: ILA ä¸­çœ‹åˆ° probe18ï¼Œä½†æ•°æ®ä¸€ç›´æ˜¯ xx

**å¯èƒ½åŸå› **ï¼š
- UART æ¨¡å—æ²¡æœ‰è¢«è§¦å‘
- capture_done æ²¡æœ‰å˜ä¸º 1

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹ **probe6 (capture_done)**ï¼Œæ˜¯å¦å˜ä¸º 1
2. æŸ¥çœ‹ **probe21 (busy)**ï¼Œæ˜¯å¦æœ‰ä¸Šå‡æ²¿
3. æ£€æŸ¥è§¦å‘æ¡ä»¶è®¾ç½®

---

### Q4: tx_data æ˜¾ç¤ºçš„å€¼ä¸å¯¹

**å¯èƒ½åŸå› **ï¼š
- BRAM æ•°æ®æ²¡æœ‰æ­£ç¡®å†™å…¥
- æµ‹è¯•ä¿¡å·æºé€‰æ‹©é”™è¯¯

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹ **probe25 (rd_data)**ï¼ˆBRAM è¯»å‡ºçš„åŸå§‹æ•°æ®ï¼‰
2. å¯¹æ¯” probe25 å’Œ probe18 æ˜¯å¦ä¸€è‡´
3. æ£€æŸ¥ `sw_test_pattern` å¼€å…³è®¾ç½®

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [docs/ILA_QUICK_START.md](ILA_QUICK_START.md) - ILA å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- [docs/UART_DEBUG_GUIDE.md](UART_DEBUG_GUIDE.md) - UART å®Œæ•´è°ƒè¯•æŒ‡å—
- [src/fpga_top.v](../src/fpga_top.v) - é¡¶å±‚æ–‡ä»¶ï¼ˆåŒ…å«æ–°çš„ probe18-25ï¼‰

---

**æ“ä½œå®Œæˆåï¼Œä½ å°±èƒ½åœ¨ ILA ä¸­çœ‹åˆ° UART å‘é€çš„æ‰€æœ‰æ•°æ®äº†ï¼** ğŸ‰
